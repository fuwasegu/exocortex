# Exocortex 使い方ガイド 🧠

AIエージェントのための「第二の脳」Exocortex の実践的な使い方を解説します。

## 目次

1. [基本的な使い方](#基本的な使い方)
2. [ツール一覧とユースケース](#ツール一覧とユースケース)
3. [実践的なワークフロー](#実践的なワークフロー)
4. [プロンプトのコツ](#プロンプトのコツ)

---

## 基本的な使い方

### 記憶を保存する

開発中に得た知見、判断の理由、失敗からの学びを保存します。

```
💬 ユーザー: 「この設計判断、記憶しておいて」

🤖 AI: exo_store_memory を使用
```

**プロンプト例:**
- 「今回の実装パターンを記憶して」
- 「この失敗と解決策を覚えておいて」
- 「この設計判断の理由を保存して」

### 記憶を思い出す

関連する過去の知見を検索します。

```
💬 ユーザー: 「認可の実装どうやったっけ？」

🤖 AI: exo_recall_memories で検索 → 関連する記憶を提示
```

**プロンプト例:**
- 「Laravelでの認可パターンを思い出して」
- 「前に同じようなバグ直したことある？」
- 「DDDの設計で気をつけることって何だっけ」

---

## ツール一覧とユースケース

### 📝 記憶の保存 (`exo_store_memory`)

| パラメータ | 説明 | 例 |
|-----------|------|-----|
| `content` | 記憶の内容（Markdown対応） | 設計判断の詳細 |
| `context_name` | プロジェクト/状況名 | `"my-webapp"`, `"api-server"` |
| `tags` | 関連キーワード | `["laravel", "ddd", "architecture"]` |
| `memory_type` | 種類 | `insight`, `success`, `failure`, `decision`, `note` |
| `is_painful` | 🔥 痛みの記憶フラグ（オプション） | `true` でハマった経験として優先 |
| `time_cost_hours` | かかった時間（オプション） | `3.0` で3時間を記録 |

**効果的な使い方:**

```markdown
# ✅ Good: 構造化された内容
## 問題
〇〇で△△が発生

## 解決策
□□パターンを適用

## 理由
- 理由1
- 理由2

# ❌ Bad: 曖昧な内容
なんかうまくいった
```

**🔥 痛みの記憶を保存する場合:**

```markdown
# ✅ Good: 苦労した経験を明示
💬 「このバグで3時間ハマった、記憶して」

🤖 AI: exo_store_memory(
    content="...",
    is_painful=True,
    time_cost_hours=3.0
)
```

内容に「nightmare」「stuck」「ハマった」などが含まれると自動検出されますが、明示的に `is_painful=True` を指定するとより確実です。

---

### 🔍 記憶の検索 (`exo_recall_memories`)

| パラメータ | 説明 | 例 |
|-----------|------|-----|
| `query` | 検索クエリ（自然言語） | `"認可の実装パターン"` |
| `limit` | 最大件数 | `5` (デフォルト) |
| `context_filter` | プロジェクトで絞り込み | `"my-webapp"` |
| `tag_filter` | タグで絞り込み | `["laravel", "ddd"]` |
| `type_filter` | 種類で絞り込み | `"decision"` |

**検索のコツ:**

```
# ✅ Good: 具体的なクエリ
「LaravelでPolicy以外の認可パターン」
「UUIDのValue Object実装で気をつけること」

# ❌ Bad: 曖昧なクエリ
「認可」
「設計」
```

---

### 🔗 記憶のリンク (`exo_link_memories`)

記憶同士を関連付けて知識グラフを構築します。

| リレーション | 意味 | 使用場面 |
|-------------|------|---------|
| `related` | 関連がある | 同じトピックの異なる側面 |
| `extends` | 拡張・発展 | 基本パターンの応用 |
| `depends_on` | 依存 | 前提知識が必要 |
| `supersedes` | 置き換え | 古い知識を更新 |
| `contradicts` | 矛盾 | 状況による使い分け |

**プロンプト例:**
- 「認可関連の記憶をリンクして」
- 「この知見は前のやつを発展させたものだからリンクして」

---

### 🌐 関連記憶の探索 (`exo_explore_related`)

ある記憶を起点に、関連する知識を探索します。

**探索される範囲:**
1. **直接リンク**: `exo_link_memories` で繋いだ記憶
2. **タグ経由**: 同じタグを持つ記憶
3. **コンテキスト経由**: 同じプロジェクトの記憶

---

### 😴 記憶の整理 (`exo_sleep`)

バックグラウンドで知識ベースを整理します。

**実行されるタスク:**
1. **重複検出**: 類似度95%以上の記憶を検出
2. **孤立救済**: タグもリンクもない記憶を関連付け
3. **パターン抽出**: 頻繁にアクセスされるトピックを概念化

**プロンプト例:**
- 「記憶を整理して」
- 「寝て」（笑）
- 「知識ベースをメンテして」

> ⚠️ **注意**: プロキシモード（`--mode proxy`）では動作が不安定な場合があります

---

### 🔬 パターン抽出 (`exo_consolidate`)

類似した記憶から共通パターンを抽出します。

| パラメータ | 説明 | 例 |
|-----------|------|-----|
| `tag_filter` | 対象タグ | `"bugfix"`, `"performance"` |
| `min_cluster_size` | 最小クラスタサイズ | `3` (デフォルト) |

**プロンプト例:**
- 「bugfix関連のパターンを抽出して」
- 「Laravelの知見をまとめて」

---

### 📊 統計情報 (`exo_get_stats`)

知識ベースの概要を表示します。

```json
{
  "total_memories": 30,
  "memories_by_type": {
    "insight": 22,
    "decision": 7,
    "success": 1
  },
  "top_tags": ["laravel", "architecture", "ddd"]
}
```

---

### 🏥 健全性チェック (`exo_analyze_knowledge`)

知識ベースの問題点を診断します。

**検出される問題:**
- 孤立した記憶（タグなし）
- リンクのない記憶
- 古くなった記憶（90日以上更新なし）

---

## 実践的なワークフロー

### 🔄 開発セッションの流れ

```
1. セッション開始
   └─ exo_recall_memories: 関連する過去の知見を確認

2. 開発中
   └─ 判断・発見があれば exo_store_memory で保存

3. セッション終了
   └─ exo_sleep: 知識ベースを整理
```

### 📚 知識の構造化フロー

```
1. 個別の記憶を蓄積
   └─ exo_store_memory × N回

2. 関連する記憶をリンク
   └─ exo_link_memories で知識グラフ構築

3. パターンを抽出
   └─ exo_consolidate で抽象化

4. 定期的に整理
   └─ exo_sleep で重複検出・孤立救済
```

### 🐛 デバッグ支援フロー

```
💬 「このエラー見たことある？」

1. exo_recall_memories で類似エラーを検索
2. 見つかれば → 過去の解決策を適用
3. 見つからなければ → 解決後に exo_store_memory で保存
```

### 🏗️ 設計レビューフロー

```
💬 「この設計どう思う？」

1. exo_recall_memories で関連する設計パターンを検索
2. exo_explore_related で周辺知識を探索
3. 過去の判断と比較してアドバイス
```

---

## プロンプトのコツ

### 記憶を保存するとき

| シチュエーション | プロンプト例 |
|-----------------|-------------|
| 設計判断 | 「この判断とその理由を記憶して」 |
| バグ修正 | 「このバグと解決策を覚えておいて」 |
| 学んだこと | 「今回学んだことを保存して」 |
| 失敗 | 「この失敗を記録して次回に活かせるように」 |
| 🔥 ハマった経験 | 「このバグで3時間ハマった、痛い記憶として保存して」 |
| 🔥 苦労した解決 | 「これ最悪だった、同じミスを繰り返さないように記憶して」 |

### 記憶を検索するとき

| シチュエーション | プロンプト例 |
|-----------------|-------------|
| 実装方法 | 「〇〇の実装パターンを思い出して」 |
| 過去の判断 | 「なんで△△にしたんだっけ？」 |
| トラブル対応 | 「同じエラー前に見た？」 |
| ベストプラクティス | 「□□のベストプラクティス教えて」 |

### 整理・分析するとき

| シチュエーション | プロンプト例 |
|-----------------|-------------|
| 定期メンテ | 「知識ベースを整理して」 |
| パターン発見 | 「〇〇関連のパターンを見つけて」 |
| 健全性確認 | 「知識ベースの状態を教えて」 |
| 関連探索 | 「これに関連する知識を探して」 |

---

## Tips & Tricks

### 🏷️ 効果的なタグ付け

```
# ✅ Good: 階層的・具体的
tags: ["laravel", "eloquent", "query-optimization", "n+1"]

# ❌ Bad: 曖昧・広すぎ
tags: ["code", "fix"]
```

### 📝 構造化されたコンテンツ

```markdown
# タイトル

## 背景・問題
何が起きていたか

## 解決策
どう解決したか

## 理由・根拠
なぜこの方法を選んだか

## 注意点
将来気をつけること
```

### 🔗 リンクの活用

- **新しい知見** → 既存の関連記憶に `extends` でリンク
- **矛盾する情報** → `contradicts` でリンクして両方残す
- **古い情報の更新** → 新しい記憶を作り `supersedes` でリンク

### 🔥 痛みの記憶の活用（Frustration Indexing）

**ソマティック・マーカー仮説**: 「痛みを伴う記憶は意思決定において優先される」

- **ハマった経験**は `is_painful=True` で保存 → 検索時に優先表示
- **時間がかかった問題**は `time_cost_hours` で記録 → フラストレーションスコアに反映
- 内容に「nightmare」「stuck」「ハマった」「最悪」があると自動検出

```
# 🔥 が多いほど優先度が高い
🔥🔥🔥 extreme (0.8-1.0): 二度と繰り返したくない
🔥🔥   high    (0.6-0.8): かなり苦労した
🔥     medium  (0.4-0.6): それなりに困った
😓     low     (0.2-0.4): ちょっとトリッキーだった
```

**プロンプト例:**
```
💬 「前に同じバグでハマったことある？」
    → 痛みの記憶が優先的にヒット 🔥

💬 「このエラー、地獄だった...記憶して」
    → 自動で高フラストレーションスコア
```

---

Happy Hacking with your Second Brain! 🧠✨

